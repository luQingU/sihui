# 🚀 Sihui 项目快速部署流程

## 📋 一分钟了解整个流程

1. **本地配置** (5分钟) → 2. **打包上传** (2分钟) → 3. **服务器一键安装** (10分钟) → 4. **访问系统** ✅

---

## 🎯 第一步：本地配置 (5分钟)

### 必填信息清单
```bash
# 1. 您的域名
your-domain.com

# 2. 数据库密码 (16位强密码)
Aa123456!@#$Bb78

# 3. JWT密钥 (64位随机字符串)
abcd1234efgh5678ijkl9012mnop3456qrst7890uvwx1234yzab5678cdef9012

# 4. 对象存储 (阿里云OSS示例)
OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
OSS_ACCESS_KEY_ID=LTAI5txxxxxxx
OSS_ACCESS_KEY_SECRET=xxxxxxxxxxxx
OSS_BUCKET_NAME=sihui-files
OSS_DOMAIN=https://sihui-files.oss-cn-hangzhou.aliyuncs.com

# 5. DeepSeek API Key
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxx

# 6. 微信小程序
WECHAT_APP_ID=wxxxxxxxxxxxxxxxxx
WECHAT_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 快速填写步骤
1. **编辑 `backend/.env`**：填写上述所有信息
2. **编辑 `frontend/.env.production`**：将域名改为您的域名
3. **编辑 `nginx/sihui.conf`**：将域名改为您的域名
4. **复制 SSL 证书**：放到 `ssl/` 目录下
5. **复制项目源码**：整个 `Sihui` 项目复制到部署包中

---

## 📦 第二步：打包上传 (2分钟)

### 1. 检查文件结构
```
完整部署包/
├── Sihui/                    # ✅ 项目源码
├── backend/.env              # ✅ 已填写配置
├── frontend/.env.production  # ✅ 已修改域名
├── nginx/sihui.conf         # ✅ 已修改域名
├── ssl/your-domain.com.crt  # ✅ SSL证书
├── ssl/your-domain.com.key  # ✅ SSL私钥
├── server-install.sh        # ✅ 安装脚本
└── 本地配置指南.md          # 📖 参考文档
```

### 2. 压缩和上传
```powershell
# 压缩部署包
Compress-Archive -Path ".\完整部署包\*" -DestinationPath ".\sihui-deployment.zip"

# 使用 XFTP 或其他工具上传到服务器 /root/ 目录
```

---

## 🖥️ 第三步：服务器一键安装 (10分钟)

### 连接服务器并执行安装
```bash
# 1. SSH连接服务器
ssh root@your-server-ip

# 2. 解压部署包
unzip sihui-deployment.zip
cd 完整部署包/

# 3. 一键安装 (自动完成所有配置)
chmod +x server-install.sh
sudo bash server-install.sh
```

### 安装脚本会自动完成：
- ✅ 系统更新
- ✅ 安装 Java 8、Maven、MySQL 8、Node.js 18、Nginx
- ✅ 创建数据库和用户
- ✅ 部署所有配置文件
- ✅ 构建前后端项目
- ✅ 执行数据库迁移
- ✅ 配置系统服务
- ✅ 配置防火墙
- ✅ 启动所有服务

---

## ✅ 第四步：验证访问

### 安装完成后立即可访问：
- 🌐 **管理端**: `https://admin.your-domain.com`
- 🔗 **API接口**: `https://api.your-domain.com`
- 📚 **API文档**: `https://api.your-domain.com/swagger-ui.html`

### 默认管理员账号：
- 用户名：`admin`
- 密码：请查看后端日志或数据库初始化脚本

---

## 🔧 常用管理命令

```bash
# 查看服务状态
systemctl status sihui-backend sihui-frontend nginx mysql

# 查看实时日志
journalctl -u sihui-backend -f
journalctl -u sihui-frontend -f

# 重启服务
systemctl restart sihui-backend
systemctl restart sihui-frontend
systemctl restart nginx

# 查看端口监听
netstat -tlnp | grep -E ':80|:443|:8080|:3000'
```

---

## 🚨 如果遇到问题

### 1. 服务启动失败
```bash
# 查看详细错误日志
journalctl -u sihui-backend -l
journalctl -u sihui-frontend -l
```

### 2. 域名无法访问
- 检查域名DNS解析是否指向服务器IP
- 确认防火墙已开放 80、443 端口

### 3. SSL证书错误
- 检查证书文件名是否与配置文件一致
- 验证证书是否匹配您的域名

### 4. 数据库连接失败
- 检查 `backend/.env` 中的数据库密码是否正确
- 确认 MySQL 服务正在运行

---

## 💡 提示和技巧

### 1. 密钥生成
```powershell
# 在 PowerShell 中快速生成密钥
# 数据库密码 (16位)
[System.Web.Security.Membership]::GeneratePassword(16, 4)

# JWT密钥 (64位)
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 64 | % {[char]$_})
```

### 2. 快速测试
```bash
# 测试API健康状态
curl https://api.your-domain.com/health

# 测试管理端响应
curl -I https://admin.your-domain.com
```

### 3. 备份重要数据
```bash
# 备份数据库
mysqldump -u sihui_user -p sihui_production > backup_$(date +%Y%m%d).sql

# 备份上传文件
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz /opt/sihui/uploads/
```

---

## 📞 技术支持

如果安装过程中遇到任何问题：

1. **检查错误日志**：运行上述日志查看命令
2. **验证配置文件**：确认所有必填项都已正确填写
3. **网络连接**：确认服务器能正常访问外网
4. **权限问题**：确认使用 root 用户执行安装脚本

---

## 🎉 恭喜！

如果所有步骤都成功完成，您的 Sihui 学习培训系统现在已经：

- ✅ 成功部署到生产服务器
- ✅ 配置了 HTTPS 安全访问
- ✅ 集成了对象存储服务
- ✅ 连接了 AI 服务
- ✅ 配置了微信小程序后端
- ✅ 设置了自动备份和监控

**现在您可以开始使用系统了！** 🎊

---

**总用时：约 17 分钟** (本地配置 5分钟 + 上传 2分钟 + 服务器安装 10分钟) 