# ğŸ“ Sihui é¡¹ç›®æœ¬åœ°é…ç½®æŒ‡å—

## ğŸ¯ ç›®æ ‡
åœ¨æœ¬åœ°å¡«å†™å¥½æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼Œæ‰“åŒ…åä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç«¯åªéœ€è¦è¿è¡Œä¸€ä¸ªè„šæœ¬å³å¯å®Œæˆéƒ¨ç½²ã€‚

## ğŸ“‹ é…ç½®å‰å‡†å¤‡æ¸…å•

### å¿…éœ€ä¿¡æ¯
- [ ] **åŸŸå**: æ‚¨çš„åŸŸå (å¦‚: example.com)
- [ ] **SSLè¯ä¹¦**: .crt å’Œ .key æ–‡ä»¶
- [ ] **æ•°æ®åº“å¯†ç **: å¼ºå¯†ç  (å»ºè®®12ä½ä»¥ä¸Š)
- [ ] **JWTå¯†é’¥**: 64ä½ä»¥ä¸Šéšæœºå­—ç¬¦ä¸²
- [ ] **å¯¹è±¡å­˜å‚¨é…ç½®**: é˜¿é‡Œäº‘OSS/è…¾è®¯äº‘COS/ä¸ƒç‰›äº‘
- [ ] **DeepSeek API Key**: AIæœåŠ¡å¯†é’¥
- [ ] **å¾®ä¿¡å°ç¨‹åº**: AppId å’Œ AppSecret

### å¯é€‰ä¿¡æ¯
- [ ] **é‚®ä»¶æœåŠ¡**: SMTPé…ç½®
- [ ] **Redisé…ç½®**: å¦‚éœ€ç¼“å­˜
- [ ] **ç›‘æ§æœåŠ¡**: Sentry DSNç­‰

---

## ğŸ”§ è¯¦ç»†é…ç½®æ­¥éª¤

### 1. ç¼–è¾‘åç«¯ç¯å¢ƒå˜é‡

æ‰“å¼€ `backend/.env` æ–‡ä»¶ï¼ŒæŒ‰ä»¥ä¸‹æ¨¡æ¿å¡«å†™ï¼š

```bash
# ===========================================
# å¿…å¡«é¡¹ç›®
# ===========================================

# æ•°æ®åº“å¯†ç  (å¿…å¡«)
DB_PASSWORD=æ‚¨çš„å¼ºå¯†ç 123!@#

# JWTå®‰å…¨å¯†é’¥ (å¿…å¡«ï¼Œ64ä½ä»¥ä¸Š)
JWT_SECRET=your_very_long_and_secure_jwt_secret_key_here_64_characters_minimum

# å¯¹è±¡å­˜å‚¨é…ç½® (ä¸‰é€‰ä¸€ï¼Œå¿…å¡«)
# é€‰æ‹©é˜¿é‡Œäº‘OSS
OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
OSS_ACCESS_KEY_ID=æ‚¨çš„AccessKeyId
OSS_ACCESS_KEY_SECRET=æ‚¨çš„AccessKeySecret
OSS_BUCKET_NAME=æ‚¨çš„Bucketåç§°
OSS_DOMAIN=https://æ‚¨çš„Bucket.oss-cn-hangzhou.aliyuncs.com

# AIæœåŠ¡é…ç½® (å¿…å¡«)
DEEPSEEK_API_KEY=æ‚¨çš„DeepSeek API Key

# å¾®ä¿¡å°ç¨‹åºé…ç½® (å¿…å¡«)
WECHAT_APP_ID=æ‚¨çš„å¾®ä¿¡å°ç¨‹åºAppId
WECHAT_APP_SECRET=æ‚¨çš„å¾®ä¿¡å°ç¨‹åºAppSecret

# ===========================================
# å¯é€‰é¡¹ç›® (æ ¹æ®éœ€è¦å¡«å†™)
# ===========================================

# é‚®ä»¶æœåŠ¡ (å¯é€‰)
MAIL_HOST=smtp.qq.com
MAIL_PORT=587
MAIL_USERNAME=your-email@qq.com
MAIL_PASSWORD=æ‚¨çš„é‚®ç®±æˆæƒç 
MAIL_FROM=your-email@qq.com

# Redisç¼“å­˜ (å¯é€‰)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=æ‚¨çš„Rediså¯†ç 
REDIS_DATABASE=0
```

### 2. ç¼–è¾‘å‰ç«¯ç¯å¢ƒå˜é‡

æ‰“å¼€ `frontend/.env.production` æ–‡ä»¶ï¼Œä¿®æ”¹åŸŸåï¼š

```bash
# APIé…ç½® (ä¿®æ”¹ä¸ºæ‚¨çš„å®é™…åŸŸå)
NEXT_PUBLIC_API_URL=https://api.æ‚¨çš„åŸŸå.com
NEXT_PUBLIC_WS_URL=wss://api.æ‚¨çš„åŸŸå.com/ws

# æ–‡ä»¶ä¸Šä¼ é…ç½® (ä¿®æ”¹ä¸ºæ‚¨çš„å®é™…åŸŸå)
NEXT_PUBLIC_UPLOAD_URL=https://api.æ‚¨çš„åŸŸå.com/api/files/upload

# å…¶ä»–é…ç½®ä¸€èˆ¬æ— éœ€ä¿®æ”¹
NEXT_PUBLIC_APP_NAME=Sihuiç®¡ç†ç³»ç»Ÿ
NEXT_PUBLIC_APP_VERSION=1.0.0
NEXT_PUBLIC_ENABLE_CHAT=true
NEXT_PUBLIC_ENABLE_VIDEO_PREVIEW=true
```

### 3. ç¼–è¾‘Nginxé…ç½®

æ‰“å¼€ `nginx/sihui.conf` æ–‡ä»¶ï¼Œä¿®æ”¹åŸŸåï¼š

```nginx
# å°†æ‰€æœ‰ "æ‚¨çš„å®é™…åŸŸå.com" æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®åŸŸå
# ä¾‹å¦‚ï¼šyour-domain.com

# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name api.your-domain.com admin.your-domain.com;
    return 301 https://$server_name$request_uri;
}

# åç«¯APIæœåŠ¡
server {
    listen 443 ssl http2;
    server_name api.your-domain.com;
    
    # SSLè¯ä¹¦é…ç½® (ä¿®æ”¹è¯ä¹¦æ–‡ä»¶å)
    ssl_certificate /opt/sihui/ssl/your-domain.com.crt;
    ssl_certificate_key /opt/sihui/ssl/your-domain.com.key;
    
    # ... å…¶ä»–é…ç½®ä¿æŒä¸å˜
}

# ç®¡ç†ç«¯å‰ç«¯æœåŠ¡  
server {
    listen 443 ssl http2;
    server_name admin.your-domain.com;
    
    # SSLè¯ä¹¦é…ç½® (ä¿®æ”¹è¯ä¹¦æ–‡ä»¶å)
    ssl_certificate /opt/sihui/ssl/your-domain.com.crt;
    ssl_certificate_key /opt/sihui/ssl/your-domain.com.key;
    
    # ... å…¶ä»–é…ç½®ä¿æŒä¸å˜
}
```

### 4. å‡†å¤‡SSLè¯ä¹¦

å°†æ‚¨çš„SSLè¯ä¹¦æ–‡ä»¶æ”¾å…¥ `ssl/` ç›®å½•ï¼š

```
ssl/
â”œâ”€â”€ your-domain.com.crt    # è¯ä¹¦æ–‡ä»¶
â”œâ”€â”€ your-domain.com.key    # ç§é’¥æ–‡ä»¶
â””â”€â”€ ca-bundle.crt          # è¯ä¹¦é“¾ (å¦‚æœ‰)
```

**è¯ä¹¦æ–‡ä»¶å‘½åè¦æ±‚**ï¼š
- æ–‡ä»¶åå¿…é¡»ä¸Nginxé…ç½®ä¸­çš„ä¸€è‡´
- å»ºè®®ä½¿ç”¨åŸŸåä½œä¸ºæ–‡ä»¶åå‰ç¼€

### 5. å‡†å¤‡é¡¹ç›®æºç 

å°†æ•´ä¸ªSihuié¡¹ç›®æºç å¤åˆ¶åˆ°éƒ¨ç½²åŒ…ä¸­ï¼š

```
å®Œæ•´éƒ¨ç½²åŒ…/
â”œâ”€â”€ Sihui/                 # é¡¹ç›®æºç ç›®å½•
â”‚   â”œâ”€â”€ sihui-backend/     # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ admin-dashboard_3/ # å‰ç«¯é¡¹ç›®
â”‚   â””â”€â”€ sihui-wx/         # å¾®ä¿¡å°ç¨‹åº (ä¸éœ€è¦éƒ¨ç½²)
â”œâ”€â”€ backend/
â”œâ”€â”€ frontend/
â”œâ”€â”€ nginx/
â”œâ”€â”€ ssl/
â”œâ”€â”€ systemd/
â””â”€â”€ server-install.sh
```

---

## ğŸ›ï¸ ä¸åŒäº‘æœåŠ¡å•†é…ç½®ç¤ºä¾‹

### é˜¿é‡Œäº‘OSSé…ç½®
```bash
OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
OSS_ACCESS_KEY_ID=LTAI5t...
OSS_ACCESS_KEY_SECRET=xxx...
OSS_BUCKET_NAME=sihui-files
OSS_DOMAIN=https://sihui-files.oss-cn-hangzhou.aliyuncs.com
```

### è…¾è®¯äº‘COSé…ç½®
```bash
# æ³¨é‡Šæ‰OSSç›¸å…³é…ç½®ï¼Œå¯ç”¨COSé…ç½®
COS_REGION=ap-guangzhou
COS_SECRET_ID=AKIDxxx...
COS_SECRET_KEY=xxx...
COS_BUCKET_NAME=sihui-files-1234567890
COS_DOMAIN=https://sihui-files-1234567890.cos.ap-guangzhou.myqcloud.com
```

### ä¸ƒç‰›äº‘é…ç½®
```bash
# æ³¨é‡Šæ‰OSSç›¸å…³é…ç½®ï¼Œå¯ç”¨ä¸ƒç‰›äº‘é…ç½®
QINIU_ACCESS_KEY=xxx...
QINIU_SECRET_KEY=xxx...
QINIU_BUCKET_NAME=sihui-files
QINIU_DOMAIN=https://cdn.your-domain.com
```

---

## ğŸ” å®‰å…¨é…ç½®å»ºè®®

### 1. å¼ºå¯†ç ç”Ÿæˆ
```bash
# æ•°æ®åº“å¯†ç ç¤ºä¾‹ (16ä½)
DB_PASSWORD=Aa123456!@#$Bb78

# JWTå¯†é’¥ç¤ºä¾‹ (64ä½)
JWT_SECRET=abcd1234efgh5678ijkl9012mnop3456qrst7890uvwx1234yzab5678cdef9012
```

### 2. å¯†é’¥ç”Ÿæˆå·¥å…·
```powershell
# Windows PowerShell ç”Ÿæˆéšæœºå¯†é’¥
# ç”Ÿæˆ16ä½æ•°æ®åº“å¯†ç 
[System.Web.Security.Membership]::GeneratePassword(16, 4)

# ç”Ÿæˆ64ä½JWTå¯†é’¥
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 64 | % {[char]$_})
```

### 3. åœ¨çº¿ç”Ÿæˆå·¥å…·
- **å¯†ç ç”Ÿæˆ**: https://passwordsgenerator.net/
- **JWTå¯†é’¥**: https://jwt.io/ æˆ– https://randomkeygen.com/

---

## ğŸ“¦ æ‰“åŒ…å’Œä¸Šä¼ 

### 1. æ£€æŸ¥é…ç½®å®Œæ•´æ€§
ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶éƒ½å·²æ­£ç¡®é…ç½®ï¼š
- [ ] `backend/.env` - æ‰€æœ‰"è¯·å¡«å†™..."éƒ½å·²æ›¿æ¢
- [ ] `frontend/.env.production` - åŸŸåå·²ä¿®æ”¹
- [ ] `nginx/sihui.conf` - åŸŸåå·²ä¿®æ”¹
- [ ] `ssl/` - è¯ä¹¦æ–‡ä»¶å·²æ”¾ç½®
- [ ] `Sihui/` - é¡¹ç›®æºç å·²å¤åˆ¶

### 2. å‹ç¼©éƒ¨ç½²åŒ…
```powershell
# ä½¿ç”¨PowerShellå‹ç¼©
Compress-Archive -Path ".\å®Œæ•´éƒ¨ç½²åŒ…\*" -DestinationPath ".\sihui-deployment.zip"
```

### 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
ä½¿ç”¨XFTPã€SCPæˆ–å…¶ä»–å·¥å…·ä¸Šä¼ ï¼š
```bash
# ä½¿ç”¨scpä¸Šä¼  (ç¤ºä¾‹)
scp sihui-deployment.zip root@your-server-ip:/root/

# åœ¨æœåŠ¡å™¨ä¸Šè§£å‹
unzip sihui-deployment.zip
```

---

## ğŸš€ æœåŠ¡å™¨ç«¯éƒ¨ç½²

### 1. è¿æ¥æœåŠ¡å™¨
```bash
ssh root@your-server-ip
```

### 2. è§£å‹å¹¶æ‰§è¡Œå®‰è£…
```bash
# è§£å‹éƒ¨ç½²åŒ…
unzip sihui-deployment.zip
cd å®Œæ•´éƒ¨ç½²åŒ…/

# æ·»åŠ æ‰§è¡Œæƒé™å¹¶è¿è¡Œ
chmod +x server-install.sh
sudo bash server-install.sh
```

### 3. å¯é€‰ï¼šä»Gitä»“åº“å®‰è£…
```bash
# å¦‚æœé¡¹ç›®åœ¨Gitä»“åº“ä¸­
sudo bash server-install.sh https://github.com/your-username/Sihui.git
```

---

## âœ… éªŒè¯éƒ¨ç½²

å®‰è£…å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

### 1. æœåŠ¡çŠ¶æ€
```bash
systemctl status sihui-backend sihui-frontend nginx mysql
```

### 2. ç«¯å£ç›‘å¬
```bash
netstat -tlnp | grep -E ':80|:443|:8080|:3000'
```

### 3. è®¿é—®æµ‹è¯•
- ğŸŒ ç®¡ç†ç«¯: https://admin.your-domain.com
- ğŸ”— APIå¥åº·æ£€æŸ¥: https://api.your-domain.com/health
- ğŸ“š APIæ–‡æ¡£: https://api.your-domain.com/swagger-ui.html

### 4. æ—¥å¿—æ£€æŸ¥
```bash
# åç«¯æ—¥å¿—
journalctl -u sihui-backend -f

# å‰ç«¯æ—¥å¿—  
journalctl -u sihui-frontend -f

# Nginxæ—¥å¿—
tail -f /var/log/nginx/access.log
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜è§£å†³

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥ `backend/.env` ä¸­çš„æ•°æ®åº“å¯†ç 
- ç¡®è®¤MySQLæœåŠ¡å·²å¯åŠ¨: `systemctl status mysql`

### 2. åŸŸåæ— æ³•è®¿é—®
- æ£€æŸ¥åŸŸåDNSè§£ææ˜¯å¦æ­£ç¡®
- ç¡®è®¤é˜²ç«å¢™å·²å¼€æ”¾80ã€443ç«¯å£

### 3. SSLè¯ä¹¦é”™è¯¯
- æ£€æŸ¥è¯ä¹¦æ–‡ä»¶è·¯å¾„å’Œæƒé™
- éªŒè¯è¯ä¹¦æ˜¯å¦åŒ¹é…åŸŸå

### 4. æœåŠ¡å¯åŠ¨å¤±è´¥
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—: `journalctl -u service-name -l`
- æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•: `nginx -t`

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. é”™è¯¯æ—¥å¿—å†…å®¹
2. æœåŠ¡å™¨ç³»ç»Ÿç‰ˆæœ¬
3. é…ç½®æ–‡ä»¶å†…å®¹ (éšå»æ•æ„Ÿä¿¡æ¯)
4. åŸŸåå’ŒSSLè¯ä¹¦ç±»å‹

**ğŸ‰ é…ç½®å®Œæˆåï¼Œæ‚¨çš„Sihuiç³»ç»Ÿå°±å¯ä»¥æŠ•å…¥ä½¿ç”¨äº†ï¼** 