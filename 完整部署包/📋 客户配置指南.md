# 📋 客户配置指南

## 🎯 配置前准备

### 您需要准备的信息：

1. **域名信息**
   - 主域名：`your-domain.com`
   - 管理端子域名：`admin.your-domain.com`
   - API子域名：`api.your-domain.com`

2. **SSL证书**
   - 证书文件：`your-domain.com.crt`
   - 私钥文件：`your-domain.com.key`

3. **数据库密码**
   - 建议使用16位强密码，包含大小写字母、数字和特殊字符
   - 示例：`Aa123456!@#$Bb78`

4. **API密钥**
   - 阿里云OSS AccessKeyId 和 AccessKeySecret
   - DeepSeek AI API Key
   - 微信小程序 AppID 和 AppSecret

## 🔧 配置步骤

### 第一步：配置后端环境

编辑 `backend/.env` 文件：

```bash
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_NAME=sihui_production
DB_USERNAME=sihui_user
DB_PASSWORD=您的数据库密码

# JWT密钥配置 (请使用64位随机字符串)
JWT_SECRET=您的JWT密钥

# 阿里云OSS配置
ALIYUN_OSS_ACCESS_KEY_ID=您的AccessKeyId
ALIYUN_OSS_ACCESS_KEY_SECRET=您的AccessKeySecret
ALIYUN_OSS_BUCKET_NAME=您的存储桶名称
ALIYUN_OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
ALIYUN_OSS_DOMAIN=您的OSS域名

# DeepSeek AI配置
DEEPSEEK_API_KEY=您的DeepSeek API Key

# 微信小程序配置
WECHAT_APP_ID=您的微信小程序AppId
WECHAT_APP_SECRET=您的微信小程序AppSecret
```

### 第二步：配置前端环境

编辑 `frontend/.env.production` 文件：

```bash
# 前端生产环境配置
NEXT_PUBLIC_API_URL=https://api.您的域名.com/api
NEXT_PUBLIC_APP_NAME=四会学习培训管理系统
NEXT_PUBLIC_APP_VERSION=1.0.0
```

### 第三步：配置Nginx

编辑 `nginx/sihui.conf` 文件，将所有 `your-domain.com` 替换为您的实际域名：

```nginx
# 将这些域名替换为您的实际域名
server_name admin.您的域名.com;
server_name api.您的域名.com;

# SSL证书路径（确保文件名匹配）
ssl_certificate /etc/ssl/certs/您的域名.com.crt;
ssl_certificate_key /etc/ssl/private/您的域名.com.key;
```

### 第四步：准备SSL证书

1. 将SSL证书文件复制到 `ssl/` 目录：
   ```
   ssl/
   ├── your-domain.com.crt
   └── your-domain.com.key
   ```

2. 确保证书文件名与nginx配置文件中的名称一致

### 第五步：复制项目源码

将 `Sihui` 目录完整复制到部署包中：
```
完整部署包/
├── Sihui/                    # 完整项目源码
├── backend/.env              # 已配置
├── frontend/.env.production  # 已配置
├── nginx/sihui.conf         # 已配置
├── ssl/                     # SSL证书
└── server-install.sh        # 安装脚本
```

## 🛠️ 密钥生成工具

### 数据库密码生成（PowerShell）
```powershell
# 生成16位强密码
[System.Web.Security.Membership]::GeneratePassword(16, 4)
```

### JWT密钥生成（PowerShell）
```powershell
# 生成64位随机字符串
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 64 | % {[char]$_})
```

### 在线密钥生成器
- 数据库密码：https://passwordsgenerator.net/
- JWT密钥：https://generate-random.org/api-key-generator

## ✅ 配置检查清单

配置完成后，请检查以下项目：

- [ ] 后端 `.env` 文件中所有配置项都已填写
- [ ] 前端 `.env.production` 文件中域名已更新
- [ ] Nginx配置文件中域名已更新
- [ ] SSL证书文件已放置在正确位置
- [ ] 项目源码已复制到部署包中
- [ ] 数据库密码足够强度
- [ ] JWT密钥为64位随机字符串
- [ ] 所有API密钥有效且有足够权限

## 🚀 开始部署

配置完成后，您可以：

1. **压缩部署包**
   ```bash
   tar -czf sihui-deployment.tar.gz 完整部署包/
   ```

2. **上传到服务器**
   使用FTP、SCP或其他方式上传到服务器

3. **执行安装**
   ```bash
   ssh root@您的服务器IP
   tar -xzf sihui-deployment.tar.gz
   cd 完整部署包/
   chmod +x server-install.sh
   sudo bash server-install.sh
   ```

## 🔍 常见配置错误

1. **域名配置错误**
   - 确保域名已正确解析到服务器IP
   - 检查子域名是否正确配置

2. **SSL证书问题**
   - 证书文件名必须与nginx配置匹配
   - 确保证书包含所有需要的域名

3. **API密钥无效**
   - 验证阿里云OSS密钥权限
   - 确认DeepSeek API密钥有效
   - 检查微信小程序密钥是否正确

4. **数据库连接失败**
   - 确保数据库密码复杂度符合要求
   - 检查数据库名称是否正确

## 📞 技术支持

如果在配置过程中遇到问题：

1. 仔细检查配置文件中的拼写和格式
2. 确认所有密钥和证书的有效性
3. 查看服务器日志了解具体错误信息
4. 联系技术支持获取帮助

---

**重要提醒**：请保存好所有配置信息和密钥，这些信息在系统维护时会用到。