# 馃殌 Sihui 椤圭洰鏈嶅姟鍣ㄩ儴缃叉寚浠?

## 馃搵 蹇€熼儴缃叉楠?

### 1. 鍑嗗宸ヤ綔
- [ ] 鏈嶅姟鍣ㄥ凡瀹夎 Ubuntu 20.04+ 鎴?CentOS 8+
- [ ] 鍩熷悕宸茶В鏋愬埌鏈嶅姟鍣↖P: sihui.example.com
- [ ] 宸插～鍐欐墍鏈夐厤缃枃浠朵腑鐨?"璇峰～鍐?.." 椤圭洰

### 2. 杩炴帴鏈嶅姟鍣ㄥ苟鍒濆鍖?
`ash
# 杩炴帴鏈嶅姟鍣?
ssh root@鎮ㄧ殑鏈嶅姟鍣↖P

# 鏇存柊绯荤粺
apt update && apt upgrade -y

# 鍒涘缓閮ㄧ讲鐩綍
mkdir -p /opt/sihui/{backend,frontend,ssl,logs,uploads,backup}

# 瀹夎鍩虹杞欢
apt install openjdk-8-jdk maven mysql-server nginx git -y

# 瀹夎 Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install nodejs -y
`

### 3. 涓婁紶椤圭洰鍜岄厤缃枃浠?
浣跨敤 XFTP 鎴栧叾浠栧伐鍏蜂笂浼狅細

**椤圭洰婧愮爜锛?*
- 涓婁紶鏁翠釜椤圭洰鍒? /opt/sihui/Sihui/

**閰嶇疆鏂囦欢锛?*
- ackend/.env 鈫?/opt/sihui/Sihui/sihui-backend/.env
- rontend/.env.production 鈫?/opt/sihui/Sihui/admin-dashboard_3/.env.production
- 
ginx/sihui.conf 鈫?/etc/nginx/conf.d/sihui.conf
- systemd/*.service 鈫?/etc/systemd/system/

**SSL璇佷功锛堝鏈夛級锛?*
- $DomainName.crt 鈫?/opt/sihui/ssl/
- $DomainName.key 鈫?/opt/sihui/ssl/

### 4. 鏁版嵁搴撳垵濮嬪寲
`ash
# 閰嶇疆 MySQL
mysql_secure_installation

# 鐧诲綍 MySQL
mysql -u root -p

# 鎵ц鍒濆鍖?
CREATE DATABASE sihui_production CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'sihui_user'@'localhost' IDENTIFIED BY '鎮ㄧ殑鏁版嵁搴撳瘑鐮?;
GRANT ALL PRIVILEGES ON sihui_production.* TO 'sihui_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;

# 鎵ц鏁版嵁搴撹縼绉昏剼鏈?
cd /opt/sihui/Sihui/sihui-backend
mysql -u sihui_user -p sihui_production < src/main/resources/db/migration/V1__Create_core_tables.sql
mysql -u sihui_user -p sihui_production < src/main/resources/db/migration/V2__Insert_initial_data.sql
mysql -u sihui_user -p sihui_production < src/main/resources/db/migration/V3__Create_chat_tables.sql
`

### 5. 鏋勫缓鍜岄儴缃查」鐩?
`ash
# 鏋勫缓鍚庣
cd /opt/sihui/Sihui/sihui-backend
mvn clean package -DskipTests
cp target/sihui-backend-*.jar /opt/sihui/backend/app.jar

# 鏋勫缓鍓嶇
cd /opt/sihui/Sihui/admin-dashboard_3
npm install --production
npm run build
cp -r .next /opt/sihui/frontend/
cp -r public /opt/sihui/frontend/
cp package.json /opt/sihui/frontend/
cp next.config.mjs /opt/sihui/frontend/

# 璁剧疆鏉冮檺
chown -R www-data:www-data /opt/sihui
chmod -R 755 /opt/sihui
`

### 6. 鍚姩鏈嶅姟
`ash
# 閲嶈浇绯荤粺鏈嶅姟閰嶇疆
systemctl daemon-reload

# 鍚姩骞惰缃紑鏈鸿嚜鍚?
systemctl enable mysql nginx sihui-backend sihui-frontend
systemctl start mysql nginx sihui-backend sihui-frontend

# 妫€鏌ユ湇鍔＄姸鎬?
systemctl status sihui-backend sihui-frontend nginx
`

### 7. 閰嶇疆闃茬伀澧?
`ash
# 鍚敤闃茬伀澧?
ufw enable

# 寮€鏀剧鍙?
ufw allow 22    # SSH
ufw allow 80    # HTTP
ufw allow 443   # HTTPS

# 鏌ョ湅鐘舵€?
ufw status
`

## 鉁?楠岃瘉閮ㄧ讲

### 妫€鏌ユ湇鍔＄姸鎬?
`ash
# 妫€鏌ョ鍙ｇ洃鍚?
netstat -tlnp | grep -E ':80|:443|:8080|:3000'

# 妫€鏌ユ棩蹇?
journalctl -u sihui-backend -f
journalctl -u sihui-frontend -f
`

### 璁块棶娴嬭瘯
- 鍚庣API: https://api.sihui.example.com/health
- 绠＄悊绔? https://admin.sihui.example.com

## 馃敡 甯哥敤绠＄悊鍛戒护

`ash
# 閲嶅惎鏈嶅姟
systemctl restart sihui-backend sihui-frontend

# 鏌ョ湅瀹炴椂鏃ュ織
journalctl -u sihui-backend -f
journalctl -u sihui-frontend -f

# 閲嶆柊鍔犺浇 Nginx 閰嶇疆
nginx -t && systemctl reload nginx

# 妫€鏌ョ郴缁熻祫婧?
top
df -h
free -h
`

## 馃啒 闂鎺掓煡

1. **鏈嶅姟鍚姩澶辫触**: 
   `ash
   journalctl -u sihui-backend -l
   journalctl -u sihui-frontend -l
   `

2. **鏁版嵁搴撹繛鎺ュけ璐?*: 妫€鏌ユ暟鎹簱鏈嶅姟鍜?.env 鏂囦欢涓殑瀵嗙爜

3. **绔彛琚崰鐢?*: 
   `ash
   netstat -tlnp | grep :绔彛鍙?
   `

4. **鏂囦欢鏉冮檺闂**: 
   `ash
   chown -R www-data:www-data /opt/sihui
   chmod -R 755 /opt/sihui
   `

---

## 馃帀 閮ㄧ讲瀹屾垚

閮ㄧ讲鎴愬姛鍚庯紝鎮ㄥ彲浠ヨ闂細
- 馃寪 绠＄悊绔? https://admin.sihui.example.com
- 馃敆 API鎺ュ彛: https://api.sihui.example.com
- 馃摎 API鏂囨。: https://api.sihui.example.com/swagger-ui.html

**娉ㄦ剰浜嬮」锛?*
1. 瀹氭湡澶囦唤鏁版嵁搴撳拰涓婁紶鏂囦欢
2. 鐩戞帶鏈嶅姟鍣ㄨ祫婧愪娇鐢ㄦ儏鍐?
3. 鍙婃椂鏇存柊绯荤粺鍜屼緷璧栧寘
4. 閰嶇疆 SSL 璇佷功鑷姩缁湡
