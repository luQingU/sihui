# ğŸš€ Sihuié¡¹ç›®æœåŠ¡å™¨éƒ¨ç½²æ¸…å•

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

**éœ€è¦éƒ¨ç½²çš„ç»„ä»¶ï¼š**
- âœ… åç«¯æœåŠ¡ (Java 8 + Spring Boot + MySQL 8)
- âœ… ç®¡ç†ç«¯ (Next.js)
- âŒ å¾®ä¿¡å°ç¨‹åº (å‘å¸ƒåˆ°å¾®ä¿¡å°ç¨‹åºå®˜ç½‘ï¼Œæ— éœ€æœåŠ¡å™¨éƒ¨ç½²)

## ğŸ–¥ï¸ æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚

### åŸºç¡€ç¯å¢ƒ
- [ ] **æ“ä½œç³»ç»Ÿ**: Linux (æ¨è Ubuntu 20.04 LTS æˆ– CentOS 8+)
- [ ] **CPU**: 2æ ¸å¿ƒä»¥ä¸Š
- [ ] **å†…å­˜**: 4GBä»¥ä¸Š (æ¨è8GB)
- [ ] **ç¡¬ç›˜**: 50GBä»¥ä¸Š SSD
- [ ] **ç½‘ç»œ**: å¤–ç½‘IPï¼Œå¼€æ”¾ç«¯å£ 80, 443, 22

### è½¯ä»¶ç¯å¢ƒ
- [ ] **Java**: OpenJDK 8 æˆ– Oracle JDK 8
- [ ] **Maven**: 3.6+
- [ ] **MySQL**: 8.0+
- [ ] **Node.js**: 18.x LTS
- [ ] **Nginx**: 1.18+
- [ ] **Docker** (å¯é€‰): æœ€æ–°ç‰ˆæœ¬
- [ ] **Git**: æœ€æ–°ç‰ˆæœ¬

## ğŸŒ åŸŸåä¸SSLè¯ä¹¦

### åŸŸåé…ç½®
- [ ] **ä¸»åŸŸå**: `your-domain.com`
- [ ] **åç«¯APIåŸŸå**: `api.your-domain.com`
- [ ] **ç®¡ç†ç«¯åŸŸå**: `admin.your-domain.com`
- [ ] **åŸŸåDNSè§£æ**: å·²è§£æåˆ°æœåŠ¡å™¨IP

### SSLè¯ä¹¦
- [ ] **è¯ä¹¦ç±»å‹**: 
  - [ ] å…è´¹è¯ä¹¦ (Let's Encrypt)
  - [ ] ä»˜è´¹è¯ä¹¦ (é˜¿é‡Œäº‘/è…¾è®¯äº‘)
- [ ] **è¯ä¹¦æ–‡ä»¶**: 
  - [ ] `your-domain.com.crt` (è¯ä¹¦æ–‡ä»¶)
  - [ ] `your-domain.com.key` (ç§é’¥æ–‡ä»¶)
  - [ ] `ca-bundle.crt` (è¯ä¹¦é“¾æ–‡ä»¶ï¼Œå¦‚æœ‰)

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### MySQLé…ç½®ä¿¡æ¯
```bash
# æ•°æ®åº“è¿æ¥ä¿¡æ¯
DB_HOST=localhost
DB_PORT=3306
DB_NAME=sihui_production
DB_USERNAME=sihui_user
DB_PASSWORD=your_secure_password

# æ•°æ®åº“rootå¯†ç 
MYSQL_ROOT_PASSWORD=your_root_password
```

### æ•°æ®åº“å‡†å¤‡
- [ ] **åˆ›å»ºæ•°æ®åº“**: `sihui_production`
- [ ] **åˆ›å»ºç”¨æˆ·**: `sihui_user`
- [ ] **æˆæƒ**: ç»™ç”¨æˆ·å®Œæ•´æƒé™
- [ ] **æ‰§è¡Œè¿ç§»è„šæœ¬**: è¿è¡Œ `/sihui-backend/src/main/resources/db/migration/` ä¸‹çš„SQLæ–‡ä»¶

## â˜ï¸ å¯¹è±¡å­˜å‚¨é…ç½®

### é˜¿é‡Œäº‘OSS (æ¨è)
```bash
# OSSé…ç½®
OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
OSS_ACCESS_KEY_ID=your_access_key_id
OSS_ACCESS_KEY_SECRET=your_access_key_secret
OSS_BUCKET_NAME=sihui-files
OSS_DOMAIN=https://your-bucket.oss-cn-hangzhou.aliyuncs.com
```

### è…¾è®¯äº‘COS (å¤‡é€‰)
```bash
# COSé…ç½®
COS_REGION=ap-guangzhou
COS_SECRET_ID=your_secret_id
COS_SECRET_KEY=your_secret_key
COS_BUCKET_NAME=sihui-files-1234567890
COS_DOMAIN=https://your-bucket.cos.ap-guangzhou.myqcloud.com
```

### ä¸ƒç‰›äº‘ (å¤‡é€‰)
```bash
# ä¸ƒç‰›äº‘é…ç½®
QINIU_ACCESS_KEY=your_access_key
QINIU_SECRET_KEY=your_secret_key
QINIU_BUCKET_NAME=sihui-files
QINIU_DOMAIN=https://your-domain.qiniucdn.com
```

## ğŸ¤– AIæœåŠ¡é…ç½®

### DeepSeeké…ç½®
```bash
# DeepSeek APIé…ç½®
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_BASE_URL=https://api.deepseek.com
```

### å…¶ä»–AIæœåŠ¡ (å¯é€‰)
```bash
# OpenAI (å¦‚éœ€è¦)
OPENAI_API_KEY=your_openai_api_key

# ç™¾åº¦æ–‡å¿ƒ (å¦‚éœ€è¦)
BAIDU_API_KEY=your_baidu_api_key
BAIDU_SECRET_KEY=your_baidu_secret_key
```

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### åç«¯ç¯å¢ƒå˜é‡ (.env)
```bash
# åº”ç”¨é…ç½®
SPRING_PROFILES_ACTIVE=production
SERVER_PORT=8080

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=sihui_production
DB_USERNAME=sihui_user
DB_PASSWORD=your_secure_password

# JWTé…ç½®
JWT_SECRET=your_very_long_and_secure_jwt_secret_key_here
JWT_EXPIRATION=604800000

# æ–‡ä»¶ä¸Šä¼ é…ç½®
FILE_UPLOAD_PATH=/opt/sihui/uploads
FILE_MAX_SIZE=10MB

# å¯¹è±¡å­˜å‚¨é…ç½® (é€‰æ‹©å…¶ä¸€)
OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
OSS_ACCESS_KEY_ID=your_access_key_id
OSS_ACCESS_KEY_SECRET=your_access_key_secret
OSS_BUCKET_NAME=sihui-files

# AIæœåŠ¡é…ç½®
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_BASE_URL=https://api.deepseek.com

# Redisé…ç½® (å¦‚ä½¿ç”¨)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

# é‚®ä»¶é…ç½® (å¦‚éœ€è¦)
MAIL_HOST=smtp.your-domain.com
MAIL_PORT=587
MAIL_USERNAME=noreply@your-domain.com
MAIL_PASSWORD=your_mail_password
```

### å‰ç«¯ç¯å¢ƒå˜é‡ (.env.production)
```bash
# APIé…ç½®
NEXT_PUBLIC_API_URL=https://api.your-domain.com
NEXT_PUBLIC_WS_URL=wss://api.your-domain.com/ws

# åº”ç”¨é…ç½®
NEXT_PUBLIC_APP_NAME=Sihuiç®¡ç†ç³»ç»Ÿ
NEXT_PUBLIC_APP_VERSION=1.0.0

# æ–‡ä»¶ä¸Šä¼ é…ç½®
NEXT_PUBLIC_MAX_FILE_SIZE=10485760
NEXT_PUBLIC_ALLOWED_FILE_TYPES=.jpg,.jpeg,.png,.pdf,.doc,.docx

# å…¶ä»–é…ç½®
NEXT_PUBLIC_ENABLE_ANALYTICS=true
```

## ğŸ“ éƒ¨ç½²ç›®å½•ç»“æ„

```
/opt/sihui/
â”œâ”€â”€ backend/                 # åç«¯é¡¹ç›®ç›®å½•
â”œâ”€â”€ frontend/               # å‰ç«¯é¡¹ç›®ç›®å½•
â”œâ”€â”€ nginx/                  # Nginxé…ç½®
â”œâ”€â”€ ssl/                    # SSLè¯ä¹¦ç›®å½•
â”œâ”€â”€ logs/                   # æ—¥å¿—ç›®å½•
â”œâ”€â”€ uploads/                # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â””â”€â”€ backup/                 # å¤‡ä»½ç›®å½•
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æœåŠ¡å™¨åˆå§‹åŒ–
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# åˆ›å»ºéƒ¨ç½²ç›®å½•
sudo mkdir -p /opt/sihui/{backend,frontend,nginx,ssl,logs,uploads,backup}
sudo chown -R $USER:$USER /opt/sihui
```

### 2. å®‰è£…åŸºç¡€è½¯ä»¶
```bash
# å®‰è£…Java 8
sudo apt install openjdk-8-jdk -y

# å®‰è£…Maven
sudo apt install maven -y

# å®‰è£…MySQL
sudo apt install mysql-server -y

# å®‰è£…Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install nodejs -y

# å®‰è£…Nginx
sudo apt install nginx -y

# å®‰è£…Git
sudo apt install git -y
```

### 3. å…‹éš†é¡¹ç›®
```bash
cd /opt/sihui
git clone https://github.com/your-username/Sihui.git
# æˆ–è€…ä½¿ç”¨XFTPä¸Šä¼ é¡¹ç›®æ–‡ä»¶
```

### 4. é…ç½®ç¯å¢ƒå˜é‡
```bash
# åç«¯ç¯å¢ƒå˜é‡
cd /opt/sihui/Sihui/sihui-backend
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä¸Šè¿°é…ç½®ä¿¡æ¯

# å‰ç«¯ç¯å¢ƒå˜é‡
cd /opt/sihui/Sihui/admin-dashboard_3
cp .env.example .env.production
# ç¼–è¾‘ .env.production æ–‡ä»¶ï¼Œå¡«å…¥ä¸Šè¿°é…ç½®ä¿¡æ¯
```

### 5. æ•°æ®åº“åˆå§‹åŒ–
```bash
# ç™»å½•MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE sihui_production;
CREATE USER 'sihui_user'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON sihui_production.* TO 'sihui_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
cd /opt/sihui/Sihui/sihui-backend
mysql -u sihui_user -p sihui_production < src/main/resources/db/migration/V1__Create_core_tables.sql
mysql -u sihui_user -p sihui_production < src/main/resources/db/migration/V2__Insert_initial_data.sql
mysql -u sihui_user -p sihui_production < src/main/resources/db/migration/V3__Create_chat_tables.sql
```

### 6. æ„å»ºå’Œéƒ¨ç½²åç«¯
```bash
cd /opt/sihui/Sihui/sihui-backend
mvn clean package -DskipTests
sudo cp target/sihui-backend-*.jar /opt/sihui/backend/app.jar
```

### 7. æ„å»ºå’Œéƒ¨ç½²å‰ç«¯
```bash
cd /opt/sihui/Sihui/admin-dashboard_3
npm install
npm run build
sudo cp -r .next /opt/sihui/frontend/
sudo cp -r public /opt/sihui/frontend/
sudo cp package.json /opt/sihui/frontend/
sudo cp next.config.mjs /opt/sihui/frontend/
```

### 8. é…ç½®Nginx
```bash
# å¤åˆ¶Nginxé…ç½®
sudo cp /opt/sihui/Sihui/config/nginx/nginx.conf /etc/nginx/
sudo cp /opt/sihui/Sihui/config/nginx/conf.d/* /etc/nginx/conf.d/

# ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„åŸŸåå’Œè·¯å¾„
sudo nano /etc/nginx/conf.d/default.conf
```

### 9. é…ç½®SSLè¯ä¹¦
```bash
# å°†SSLè¯ä¹¦å¤åˆ¶åˆ°æŒ‡å®šç›®å½•
sudo cp your-domain.com.crt /opt/sihui/ssl/
sudo cp your-domain.com.key /opt/sihui/ssl/
sudo chmod 600 /opt/sihui/ssl/*
```

### 10. åˆ›å»ºç³»ç»ŸæœåŠ¡
```bash
# åç«¯æœåŠ¡
sudo tee /etc/systemd/system/sihui-backend.service > /dev/null <<EOF
[Unit]
Description=Sihui Backend Service
After=mysql.service

[Service]
Type=simple
User=www-data
ExecStart=/usr/bin/java -jar /opt/sihui/backend/app.jar
Restart=always
RestartSec=10
Environment=SPRING_PROFILES_ACTIVE=production

[Install]
WantedBy=multi-user.target
EOF

# å‰ç«¯æœåŠ¡
sudo tee /etc/systemd/system/sihui-frontend.service > /dev/null <<EOF
[Unit]
Description=Sihui Frontend Service
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/sihui/frontend
ExecStart=/usr/bin/npm start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF
```

### 11. å¯åŠ¨æœåŠ¡
```bash
# é‡è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable mysql nginx sihui-backend sihui-frontend
sudo systemctl start mysql nginx sihui-backend sihui-frontend

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status sihui-backend sihui-frontend nginx
```

## ğŸ” éƒ¨ç½²éªŒè¯

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep -E ':80|:443|:8080|:3000'

# æ£€æŸ¥æ—¥å¿—
sudo journalctl -u sihui-backend -f
sudo journalctl -u sihui-frontend -f

# æ£€æŸ¥NginxçŠ¶æ€
sudo nginx -t
```

### è®¿é—®æµ‹è¯•
- [ ] **åç«¯API**: `https://api.your-domain.com/health`
- [ ] **ç®¡ç†ç«¯**: `https://admin.your-domain.com`
- [ ] **SSLè¯ä¹¦**: æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ˜¾ç¤ºå®‰å…¨é”

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### é˜²ç«å¢™é…ç½®
```bash
# å¯ç”¨UFWé˜²ç«å¢™
sudo ufw enable

# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

### å…¶ä»–å®‰å…¨æªæ–½
- [ ] **ä¿®æ”¹SSHç«¯å£** (é22)
- [ ] **ç¦ç”¨rootç”¨æˆ·SSHç™»å½•**
- [ ] **é…ç½®fail2ban** é˜²æ­¢æš´åŠ›ç ´è§£
- [ ] **å®šæœŸå¤‡ä»½æ•°æ®åº“**
- [ ] **è®¾ç½®logrotate** æ—¥å¿—è½®è½¬

## ğŸ“ ç›‘æ§ä¸ç»´æŠ¤

### æ—¥å¿—ä½ç½®
- **Nginxæ—¥å¿—**: `/var/log/nginx/`
- **åç«¯æ—¥å¿—**: `/opt/sihui/logs/`
- **å‰ç«¯æ—¥å¿—**: `sudo journalctl -u sihui-frontend`
- **ç³»ç»Ÿæ—¥å¿—**: `/var/log/syslog`

### å¤‡ä»½è„šæœ¬
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo tee /opt/sihui/backup/backup.sh > /dev/null <<'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
mysqldump -u sihui_user -p sihui_production > /opt/sihui/backup/database_$DATE.sql
tar -czf /opt/sihui/backup/uploads_$DATE.tar.gz /opt/sihui/uploads/
EOF

sudo chmod +x /opt/sihui/backup/backup.sh
```

## ğŸ“ è”ç³»ä¿¡æ¯

### å¼€å‘å›¢é˜Ÿ
- **åç«¯å¼€å‘**: [æ‚¨çš„è”ç³»æ–¹å¼]
- **å‰ç«¯å¼€å‘**: [æ‚¨çš„è”ç³»æ–¹å¼]
- **è¿ç»´æ”¯æŒ**: [æ‚¨çš„è”ç³»æ–¹å¼]

### ç´§æ€¥è”ç³»
- **æœåŠ¡å™¨é—®é¢˜**: [è”ç³»æ–¹å¼]
- **åŸŸåé—®é¢˜**: [åŸŸåæœåŠ¡å•†]
- **SSLè¯ä¹¦é—®é¢˜**: [è¯ä¹¦æœåŠ¡å•†]

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ‰€æœ‰é¡¹ç›®åï¼Œæ‚¨çš„é¡¹ç›®å°±æˆåŠŸéƒ¨ç½²äº†ï¼š

- [ ] æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡å®Œæˆ
- [ ] åŸŸåè§£æé…ç½®å®Œæˆ
- [ ] SSLè¯ä¹¦å®‰è£…å®Œæˆ
- [ ] æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
- [ ] åç«¯æœåŠ¡éƒ¨ç½²å®Œæˆ
- [ ] å‰ç«¯æœåŠ¡éƒ¨ç½²å®Œæˆ
- [ ] Nginxé…ç½®å®Œæˆ
- [ ] é˜²ç«å¢™é…ç½®å®Œæˆ
- [ ] æœåŠ¡è‡ªå¯åŠ¨é…ç½®å®Œæˆ
- [ ] å¤‡ä»½ç­–ç•¥é…ç½®å®Œæˆ
- [ ] ç›‘æ§å‘Šè­¦é…ç½®å®Œæˆ
- [ ] è®¿é—®æµ‹è¯•é€šè¿‡

**ğŸ‰ æ­å–œï¼æ‚¨çš„Sihuié¡¹ç›®å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨ï¼** 