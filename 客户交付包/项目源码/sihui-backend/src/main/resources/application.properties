# ===========================================
# Sihui Backend 应用配置
# ===========================================

# 应用服务配置
server.port=${SERVER_PORT:8080}

# 数据库配置
spring.datasource.url=jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:sihui_production}?useUnicode=true&characterEncoding=utf8mb4&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useConfigs=maxPerformance
spring.datasource.username=${DB_USERNAME:sihui_user}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# 数据库连接池配置
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL_SIZE:20}
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:5}
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.leak-detection-threshold=60000

# JPA 配置
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# Flyway 数据库迁移配置
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true
spring.flyway.encoding=UTF-8

# JWT 配置
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:86400000}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}
jwt.issuer=${JWT_ISSUER:sihui-training-platform}
jwt.audience=${JWT_AUDIENCE:sihui-users}
jwt.clock-skew-seconds=5

# 安全配置
security.jwt.max-login-attempts=${SECURITY_MAX_LOGIN_ATTEMPTS:5}
security.jwt.login-lockout-duration=${SECURITY_LOGIN_LOCKOUT_DURATION:300000}
security.audit.enabled=true
security.audit.log-successful-logins=true
security.audit.log-failed-logins=true

# 阿里云OSS配置
aliyun.oss.endpoint=${OSS_ENDPOINT:}
aliyun.oss.access-key-id=${OSS_ACCESS_KEY_ID:}
aliyun.oss.access-key-secret=${OSS_ACCESS_KEY_SECRET:}
aliyun.oss.bucket-name=${OSS_BUCKET_NAME:}
aliyun.oss.domain=${OSS_DOMAIN:}
aliyun.oss.max-file-size=${FILE_UPLOAD_MAX_SIZE:50MB}
aliyun.oss.allowed-file-types=${FILE_UPLOAD_ALLOWED_TYPES:mp4,avi,mov,wmv,flv,mkv,pdf,doc,docx,ppt,pptx,xls,xlsx,txt,jpg,jpeg,png,gif}

# 腾讯云COS配置
tencent.cos.region=${COS_REGION:}
tencent.cos.secret-id=${COS_SECRET_ID:}
tencent.cos.secret-key=${COS_SECRET_KEY:}
tencent.cos.bucket-name=${COS_BUCKET_NAME:}
tencent.cos.domain=${COS_DOMAIN:}

# 七牛云配置
qiniu.access-key=${QINIU_ACCESS_KEY:}
qiniu.secret-key=${QINIU_SECRET_KEY:}
qiniu.bucket-name=${QINIU_BUCKET_NAME:}
qiniu.domain=${QINIU_DOMAIN:}

# DeepSeek AI 配置
deepseek.api.key=${DEEPSEEK_API_KEY:}
deepseek.api.url=${DEEPSEEK_API_URL:https://api.deepseek.com/v1/chat/completions}
deepseek.api.model=${DEEPSEEK_MODEL:deepseek-chat}
deepseek.api.temperature=0.7
deepseek.api.max-tokens=1000

# 微信小程序配置
wechat.app-id=${WECHAT_APP_ID:}
wechat.app-secret=${WECHAT_APP_SECRET:}

# Redis配置 (可选)
spring.redis.host=${REDIS_HOST:localhost}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD:}
spring.redis.database=${REDIS_DATABASE:0}
spring.redis.timeout=3000ms
spring.redis.jedis.pool.max-active=20
spring.redis.jedis.pool.max-idle=10
spring.redis.jedis.pool.min-idle=5
spring.redis.jedis.pool.max-wait=3000ms

# 缓存配置
spring.cache.type=redis
spring.cache.redis.time-to-live=PT30M
spring.cache.redis.cache-null-values=false
spring.cache.redis.key-prefix=sihui:cache:

# 邮件配置 (可选)
spring.mail.host=${MAIL_HOST:}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.default-encoding=UTF-8
mail.from=${MAIL_FROM:}

# 服务器配置
server.tomcat.max-threads=${TOMCAT_MAX_THREADS:200}
server.tomcat.min-spare-threads=20
server.tomcat.max-connections=${TOMCAT_MAX_CONNECTIONS:8192}
server.tomcat.accept-count=1000
server.tomcat.connection-timeout=20000
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# 文件上传配置
spring.servlet.multipart.max-file-size=${FILE_UPLOAD_MAX_SIZE:50MB}
spring.servlet.multipart.max-request-size=${FILE_UPLOAD_MAX_SIZE:50MB}

# 监控配置
management.server.port=${MANAGEMENT_PORT:8081}
management.endpoints.web.exposure.include=health,info,metrics,prometheus,caches
management.endpoint.health.show-details=always
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true

# 日志配置
logging.level.root=${LOGGING_LEVEL:INFO}
logging.level.com.vote.sihuibackend=DEBUG
logging.level.org.springframework.cache=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# 异步配置
spring.task.execution.pool.core-size=8
spring.task.execution.pool.max-size=32
spring.task.execution.pool.queue-capacity=200
spring.task.execution.pool.keep-alive=60s
spring.task.execution.thread-name-prefix=async-task-

spring.task.scheduling.pool.size=5
spring.task.scheduling.thread-name-prefix=scheduled-task-

# 应用信息
app.name=${APP_NAME:Sihui Backend}
app.version=${APP_VERSION:1.0.0}
app.description=${APP_DESCRIPTION:四会项目后端服务}

# HTTP客户端配置
spring.http.client.connection-timeout=5000
spring.http.client.read-timeout=30000

# Swagger配置
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.config-url=/api-docs/swagger-config
springdoc.swagger-ui.url=/api-docs

