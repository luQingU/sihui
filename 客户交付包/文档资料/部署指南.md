# ğŸ“– Sihui æ™ºæ…§å­¦ä¹ å¹³å°éƒ¨ç½²æŒ‡å—

## ğŸ¯ éƒ¨ç½²æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸ŠæˆåŠŸéƒ¨ç½² Sihui æ™ºæ…§å­¦ä¹ å¹³å°ã€‚ç³»ç»Ÿæ”¯æŒä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š

1. **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼ˆæ¨èï¼‰- ä¸€é”®æ‰§è¡Œè„šæœ¬å®Œæˆæ‰€æœ‰é…ç½®
2. **æ‰‹åŠ¨éƒ¨ç½²** - é€æ­¥æ‰§è¡Œæ¯ä¸ªé…ç½®æ­¥éª¤

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### æœåŠ¡å™¨åŸºæœ¬è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04 LTS æˆ– CentOS 8+
- **CPU**: 2æ ¸å¿ƒä»¥ä¸Šï¼ˆæ¨è4æ ¸å¿ƒï¼‰
- **å†…å­˜**: 4GBä»¥ä¸Šï¼ˆæ¨è8GBï¼‰
- **å­˜å‚¨**: 50GBä»¥ä¸Š SSDï¼ˆæ¨è100GBï¼‰
- **ç½‘ç»œ**: å¤–ç½‘IPåœ°å€ï¼Œå¸¦å®½5Mbpsä»¥ä¸Š

### ç½‘ç»œç«¯å£è¦æ±‚
- **22**: SSHç®¡ç†ç«¯å£
- **80**: HTTPè®¿é—®ç«¯å£ï¼ˆé‡å®šå‘åˆ°HTTPSï¼‰
- **443**: HTTPSè®¿é—®ç«¯å£
- **8080**: åç«¯APIæœåŠ¡ç«¯å£ï¼ˆå†…éƒ¨ï¼‰
- **3000**: å‰ç«¯æœåŠ¡ç«¯å£ï¼ˆå†…éƒ¨ï¼‰
- **3306**: MySQLæ•°æ®åº“ç«¯å£ï¼ˆå†…éƒ¨ï¼‰

### ç¬¬ä¸‰æ–¹æœåŠ¡è¦æ±‚
- **åŸŸå**: ç”¨äºç³»ç»Ÿè®¿é—®ï¼ˆå¿…éœ€ï¼‰
- **SSLè¯ä¹¦**: HTTPSå®‰å…¨è®¿é—®ï¼ˆå¿…éœ€ï¼‰
- **å¯¹è±¡å­˜å‚¨**: é˜¿é‡Œäº‘OSS/è…¾è®¯äº‘COS/ä¸ƒç‰›äº‘ï¼ˆå¿…éœ€ï¼‰
- **AIæœåŠ¡**: DeepSeek API Keyï¼ˆå¿…éœ€ï¼‰
- **å¾®ä¿¡å°ç¨‹åº**: AppIdå’ŒAppSecretï¼ˆå¿…éœ€ï¼‰

## ğŸš€ è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆæ¨èï¼‰

### æ­¥éª¤1ï¼šå‡†å¤‡é…ç½®æ–‡ä»¶

1. **ç¼–è¾‘åç«¯é…ç½®**
   ```bash
   # æ‰“å¼€é…ç½®æ–‡ä»¶
   vi éƒ¨ç½²é…ç½®/backend/.env
   ```
   
   **å¿…å¡«é¡¹ç›®**ï¼š
   ```bash
   # æ•°æ®åº“å¯†ç ï¼ˆ16ä½ä»¥ä¸Šå¼ºå¯†ç ï¼‰
   DB_PASSWORD=Aa123456!@#$Bb78
   
   # JWTå¯†é’¥ï¼ˆ64ä½ä»¥ä¸Šéšæœºå­—ç¬¦ä¸²ï¼‰
   JWT_SECRET=abcd1234efgh5678ijkl9012mnop3456qrst7890uvwx1234yzab5678cdef9012
   
   # é˜¿é‡Œäº‘OSSé…ç½®
   OSS_ACCESS_KEY_ID=LTAI5txxxxxxx
   OSS_ACCESS_KEY_SECRET=xxxxxxxxxxxx
   OSS_BUCKET_NAME=sihui-files
   OSS_DOMAIN=https://sihui-files.oss-cn-hangzhou.aliyuncs.com
   
   # DeepSeek AI Key
   DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxx
   
   # å¾®ä¿¡å°ç¨‹åºé…ç½®
   WECHAT_APP_ID=wxxxxxxxxxxxxxxxxx
   WECHAT_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```

2. **ç¼–è¾‘å‰ç«¯é…ç½®**
   ```bash
   # æ‰“å¼€é…ç½®æ–‡ä»¶
   vi éƒ¨ç½²é…ç½®/frontend/.env.production
   ```
   
   **ä¿®æ”¹åŸŸå**ï¼š
   ```bash
   # å°†ä¸‹é¢çš„åŸŸåæ”¹ä¸ºæ‚¨çš„å®é™…åŸŸå
   NEXT_PUBLIC_API_URL=https://api.æ‚¨çš„åŸŸå.com
   NEXT_PUBLIC_WS_URL=wss://api.æ‚¨çš„åŸŸå.com/ws
   ```

3. **ç¼–è¾‘Nginxé…ç½®**
   ```bash
   # æ‰“å¼€é…ç½®æ–‡ä»¶
   vi éƒ¨ç½²é…ç½®/nginx/sihui.conf
   
   # å…¨å±€æ›¿æ¢åŸŸåï¼ˆvimå‘½ä»¤ï¼‰
   :%s/æ‚¨çš„åŸŸå.com/example.com/g
   ```

4. **æ”¾ç½®SSLè¯ä¹¦**
   ```bash
   # å°†æ‚¨çš„SSLè¯ä¹¦æ–‡ä»¶æ”¾åˆ°sslç›®å½•
   cp your-domain.com.crt éƒ¨ç½²é…ç½®/ssl/
   cp your-domain.com.key éƒ¨ç½²é…ç½®/ssl/
   ```

### æ­¥éª¤2ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# å‹ç¼©äº¤ä»˜åŒ…
tar -czf sihui-deployment.tar.gz å®¢æˆ·äº¤ä»˜åŒ…/

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp sihui-deployment.tar.gz root@your-server-ip:/root/

# æˆ–ä½¿ç”¨ rsyncï¼ˆæ¨èï¼‰
rsync -avz å®¢æˆ·äº¤ä»˜åŒ…/ root@your-server-ip:/root/sihui-deployment/
```

### æ­¥éª¤3ï¼šæ‰§è¡Œè‡ªåŠ¨éƒ¨ç½²

```bash
# SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# è§£å‹éƒ¨ç½²åŒ…
cd /root
tar -xzf sihui-deployment.tar.gz
cd å®¢æˆ·äº¤ä»˜åŒ…/

# æ‰§è¡Œè‡ªåŠ¨éƒ¨ç½²è„šæœ¬
chmod +x è‡ªåŠ¨åŒ–è„šæœ¬/éƒ¨ç½²å®‰è£…è„šæœ¬.sh
./è‡ªåŠ¨åŒ–è„šæœ¬/éƒ¨ç½²å®‰è£…è„šæœ¬.sh
```

### æ­¥éª¤4ï¼šéªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼Œè„šæœ¬ä¼šè‡ªåŠ¨è¿›è¡ŒéªŒè¯ã€‚æ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status sihui-backend sihui-frontend nginx mysql

# æ£€æŸ¥ç«¯å£ç›‘å¬
ss -tlnp | grep -E ':80|:443|:8080|:3000'

# æµ‹è¯•APIå¥åº·çŠ¶æ€
curl https://api.your-domain.com/health

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
journalctl -u sihui-backend -f
```

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²

å¦‚æœæ‚¨é€‰æ‹©æ‰‹åŠ¨éƒ¨ç½²ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### 1. æ›´æ–°ç³»ç»Ÿ

**Ubuntu/Debian:**
```bash
apt update && apt upgrade -y
```

**CentOS/RHEL:**
```bash
yum update -y
```

### 2. å®‰è£…åŸºç¡€è½¯ä»¶

**Ubuntu/Debian:**
```bash
# å®‰è£…åŸºç¡€åŒ…
apt install -y curl wget git unzip nginx mysql-server

# å®‰è£… Java 8
apt install -y openjdk-8-jdk maven

# å®‰è£… Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs
```

**CentOS/RHEL:**
```bash
# å®‰è£…åŸºç¡€åŒ…
yum install -y curl wget git unzip nginx mysql-server

# å®‰è£… Java 8
yum install -y java-1.8.0-openjdk maven

# å®‰è£… Node.js 18
curl -fsSL https://rpm.nodesource.com/setup_18.x | bash -
yum install -y nodejs
```

### 3. åˆ›å»ºç›®å½•ç»“æ„

```bash
mkdir -p /opt/sihui/{backend,frontend,nginx,ssl,logs,uploads,backup}
chown -R www-data:www-data /opt/sihui  # Ubuntu
# æˆ–
chown -R nginx:nginx /opt/sihui        # CentOS
```

### 4. é…ç½®MySQL

```bash
# å¯åŠ¨MySQL
systemctl start mysql
systemctl enable mysql

# ç™»å½•MySQLï¼ˆé¦–æ¬¡æ— å¯†ç ï¼‰
mysql -u root

# åœ¨MySQLä¸­æ‰§è¡Œ
CREATE DATABASE sihui_production;
CREATE USER 'sihui_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON sihui_production.* TO 'sihui_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 5. éƒ¨ç½²åç«¯

```bash
# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
cp -r é¡¹ç›®æºç /sihui-backend/* /opt/sihui/backend/
cp éƒ¨ç½²é…ç½®/backend/.env /opt/sihui/backend/

# æ„å»ºé¡¹ç›®
cd /opt/sihui/backend
mvn clean package -DskipTests

# å¤åˆ¶jaræ–‡ä»¶
cp target/sihui-backend-*.jar /opt/sihui/backend/app.jar
```

### 6. éƒ¨ç½²å‰ç«¯

```bash
# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
cp -r é¡¹ç›®æºç /admin-dashboard_3/* /opt/sihui/frontend/
cp éƒ¨ç½²é…ç½®/frontend/.env.production /opt/sihui/frontend/

# å®‰è£…ä¾èµ–å¹¶æ„å»º
cd /opt/sihui/frontend
npm ci --production
npm run build
```

### 7. é…ç½®Nginx

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp éƒ¨ç½²é…ç½®/nginx/sihui.conf /etc/nginx/sites-available/  # Ubuntu
# æˆ–
cp éƒ¨ç½²é…ç½®/nginx/sihui.conf /etc/nginx/conf.d/          # CentOS

# å¯ç”¨ç«™ç‚¹ï¼ˆUbuntuï¼‰
ln -sf /etc/nginx/sites-available/sihui.conf /etc/nginx/sites-enabled/

# å¤åˆ¶SSLè¯ä¹¦
cp éƒ¨ç½²é…ç½®/ssl/* /opt/sihui/ssl/
chmod 600 /opt/sihui/ssl/*

# æµ‹è¯•é…ç½®
nginx -t
```

### 8. åˆ›å»ºç³»ç»ŸæœåŠ¡

**åç«¯æœåŠ¡:**
```bash
cat > /etc/systemd/system/sihui-backend.service <<EOF
[Unit]
Description=Sihui Backend Service
After=mysql.service

[Service]
Type=simple
User=www-data
ExecStart=/usr/bin/java -jar /opt/sihui/backend/app.jar
WorkingDirectory=/opt/sihui/backend
Restart=always
RestartSec=10
Environment=SPRING_PROFILES_ACTIVE=production

[Install]
WantedBy=multi-user.target
EOF
```

**å‰ç«¯æœåŠ¡:**
```bash
cat > /etc/systemd/system/sihui-frontend.service <<EOF
[Unit]
Description=Sihui Frontend Service
After=network.target

[Service]
Type=simple
User=www-data
ExecStart=/usr/bin/npm start
WorkingDirectory=/opt/sihui/frontend
Restart=always
RestartSec=10
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
EOF
```

### 9. å¯åŠ¨æœåŠ¡

```bash
# é‡è½½systemdé…ç½®
systemctl daemon-reload

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable --now mysql nginx sihui-backend sihui-frontend

# æ£€æŸ¥çŠ¶æ€
systemctl status sihui-backend sihui-frontend nginx
```

### 10. é…ç½®é˜²ç«å¢™

**Ubuntu (UFW):**
```bash
ufw enable
ufw allow ssh
ufw allow 80/tcp
ufw allow 443/tcp
```

**CentOS (Firewalld):**
```bash
systemctl enable --now firewalld
firewall-cmd --permanent --add-service=ssh
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```

## ğŸ” éƒ¨ç½²éªŒè¯

### 1. æœåŠ¡æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
systemctl status sihui-backend sihui-frontend nginx mysql

# æ£€æŸ¥ç«¯å£ç›‘å¬
ss -tlnp | grep -E ':80|:443|:8080|:3000|:3306'

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
```

### 2. åŠŸèƒ½æµ‹è¯•

1. **åç«¯APIæµ‹è¯•**
   ```bash
   # å¥åº·æ£€æŸ¥
   curl https://api.your-domain.com/health
   
   # Swaggeræ–‡æ¡£
   curl https://api.your-domain.com/swagger-ui.html
   ```

2. **å‰ç«¯è®¿é—®æµ‹è¯•**
   - æµè§ˆå™¨è®¿é—®ï¼š`https://admin.your-domain.com`
   - æ£€æŸ¥ç™»å½•é¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
   - æµ‹è¯•ç”¨æˆ·ç™»å½•åŠŸèƒ½

3. **æ•°æ®åº“è¿æ¥æµ‹è¯•**
   ```bash
   # è¿æ¥æ•°æ®åº“
   mysql -u sihui_user -p sihui_production
   
   # æŸ¥çœ‹è¡¨ç»“æ„
   SHOW TABLES;
   ```

### 3. æ€§èƒ½æµ‹è¯•

```bash
# CPUä½¿ç”¨ç‡
top

# å†…å­˜ä½¿ç”¨
free -h

# ç£ç›˜I/O
iotop

# ç½‘ç»œè¿æ¥
netstat -tlnp
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. æœåŠ¡å¯åŠ¨å¤±è´¥**
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
journalctl -u sihui-backend -l
journalctl -u sihui-frontend -l

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /opt/sihui/backend/.env
cat /opt/sihui/frontend/.env.production
```

**2. æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥MySQLçŠ¶æ€
systemctl status mysql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u sihui_user -p -h localhost

# æ£€æŸ¥æ•°æ®åº“é…ç½®
grep DB_ /opt/sihui/backend/.env
```

**3. Nginxé…ç½®é”™è¯¯**
```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log

# æ£€æŸ¥ç«¯å£å ç”¨
ss -tlnp | grep :80
```

**4. SSLè¯ä¹¦é—®é¢˜**
```bash
# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶
ls -la /opt/sihui/ssl/

# æµ‹è¯•è¯ä¹¦
openssl x509 -in /opt/sihui/ssl/your-domain.com.crt -text -noout

# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in /opt/sihui/ssl/your-domain.com.crt -noout -dates
```

### æ—¥å¿—ä½ç½®

- **Nginxæ—¥å¿—**: `/var/log/nginx/`
- **åç«¯æ—¥å¿—**: `journalctl -u sihui-backend`
- **å‰ç«¯æ—¥å¿—**: `journalctl -u sihui-frontend`
- **MySQLæ—¥å¿—**: `/var/log/mysql/`
- **ç³»ç»Ÿæ—¥å¿—**: `/var/log/syslog`

## ğŸ”„ æ›´æ–°å‡çº§

### åº”ç”¨æ›´æ–°

```bash
# åœæ­¢æœåŠ¡
systemctl stop sihui-backend sihui-frontend

# å¤‡ä»½å½“å‰ç‰ˆæœ¬
cp /opt/sihui/backend/app.jar /opt/sihui/backup/app.jar.backup

# éƒ¨ç½²æ–°ç‰ˆæœ¬
cp new-version/app.jar /opt/sihui/backend/

# é‡å¯æœåŠ¡
systemctl start sihui-backend sihui-frontend
```

### æ•°æ®åº“è¿ç§»

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u sihui_user -p sihui_production > backup.sql

# æ‰§è¡Œè¿ç§»è„šæœ¬
mysql -u sihui_user -p sihui_production < migration.sql
```

## ğŸ éƒ¨ç½²å®Œæˆ

æ­å–œï¼æ‚¨å·²æˆåŠŸéƒ¨ç½² Sihui æ™ºæ…§å­¦ä¹ å¹³å°ã€‚

**è®¿é—®åœ°å€ï¼š**
- ç®¡ç†åå°ï¼š`https://admin.your-domain.com`
- APIæœåŠ¡ï¼š`https://api.your-domain.com`
- APIæ–‡æ¡£ï¼š`https://api.your-domain.com/swagger-ui.html`

**ä¸‹ä¸€æ­¥ï¼š**
1. ç™»å½•ç®¡ç†åå°åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
2. é…ç½®ç³»ç»ŸåŸºæœ¬ä¿¡æ¯
3. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ¨¡å—
4. é…ç½®æ•°æ®å¤‡ä»½ç­–ç•¥
5. è®¾ç½®ç›‘æ§å‘Šè­¦

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤ç« èŠ‚æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚