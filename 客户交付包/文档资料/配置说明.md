# ⚙️ Sihui 智慧学习平台配置说明

## 📋 概述

本文档详细说明 Sihui 智慧学习平台的所有配置项，包括后端环境变量、前端配置、Nginx 配置等。

## 🔧 后端配置 (.env)

### 必填配置项

#### 数据库配置
```bash
# 数据库主机地址
DB_HOST=localhost
# 说明: MySQL数据库服务器地址，本地部署使用localhost

# 数据库端口
DB_PORT=3306
# 说明: MySQL默认端口，除非有特殊需求，否则保持3306

# 数据库名称
DB_NAME=sihui_production
# 说明: 生产环境数据库名称，建议使用有意义的名称

# 数据库用户名
DB_USERNAME=sihui_user
# 说明: 专用数据库用户，不建议使用root用户

# 数据库密码
DB_PASSWORD=请填写数据库密码
# 说明: 强密码，建议16位以上，包含大小写字母、数字和特殊字符
# 示例: Aa123456!@#$Bb78
```

#### JWT安全配置
```bash
# JWT密钥
JWT_SECRET=请填写64位以上的安全密钥
# 说明: 用于签名JWT令牌的密钥，必须64位以上随机字符串
# 生成方法: openssl rand -base64 64
# 示例: abcd1234efgh5678ijkl9012mnop3456qrst7890uvwx1234yzab5678cdef9012

# JWT令牌有效期（毫秒）
JWT_EXPIRATION=86400000
# 说明: 24小时=86400000毫秒，可根据安全需求调整

# JWT刷新令牌有效期（毫秒）
JWT_REFRESH_EXPIRATION=604800000
# 说明: 7天=604800000毫秒，用于自动续期

# JWT签发者
JWT_ISSUER=sihui-training-platform
# 说明: 令牌签发者标识，用于令牌验证

# JWT受众
JWT_AUDIENCE=sihui-users
# 说明: 令牌目标受众，增加安全性
```

#### 对象存储配置（三选一）

**阿里云OSS（推荐）**
```bash
# OSS端点
OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
# 说明: 阿里云OSS地域端点，根据bucket所在地域选择
# 常用地域:
# - 华东1(杭州): https://oss-cn-hangzhou.aliyuncs.com
# - 华北2(北京): https://oss-cn-beijing.aliyuncs.com
# - 华南1(深圳): https://oss-cn-shenzhen.aliyuncs.com

# OSS访问密钥ID
OSS_ACCESS_KEY_ID=请填写阿里云AccessKeyId
# 说明: 阿里云RAM用户的AccessKey ID

# OSS访问密钥Secret
OSS_ACCESS_KEY_SECRET=请填写阿里云AccessKeySecret
# 说明: 阿里云RAM用户的AccessKey Secret

# OSS存储桶名称
OSS_BUCKET_NAME=请填写Bucket名称
# 说明: 预先创建的OSS bucket名称

# OSS访问域名
OSS_DOMAIN=请填写自定义域名或默认域名
# 说明: 用于文件访问的域名，可以是默认域名或自定义域名
# 示例: https://sihui-files.oss-cn-hangzhou.aliyuncs.com
```

**腾讯云COS（备选）**
```bash
# COS地域
COS_REGION=ap-guangzhou
# 说明: 腾讯云COS地域标识
# 常用地域: ap-guangzhou, ap-shanghai, ap-beijing

# COS密钥ID
COS_SECRET_ID=请填写腾讯云SecretId
# 说明: 腾讯云API密钥ID

# COS密钥Key
COS_SECRET_KEY=请填写腾讯云SecretKey
# 说明: 腾讯云API密钥Key

# COS存储桶名称
COS_BUCKET_NAME=请填写Bucket名称
# 说明: 腾讯云COS bucket名称，格式为 name-appid

# COS访问域名
COS_DOMAIN=请填写访问域名
# 说明: COS访问域名，可以是默认域名或CDN域名
```

**七牛云（备选）**
```bash
# 七牛云AccessKey
QINIU_ACCESS_KEY=请填写七牛云AccessKey
# 说明: 七牛云账户的AccessKey

# 七牛云SecretKey
QINIU_SECRET_KEY=请填写七牛云SecretKey
# 说明: 七牛云账户的SecretKey

# 七牛云空间名称
QINIU_BUCKET_NAME=请填写空间名称
# 说明: 七牛云对象存储空间名称

# 七牛云访问域名
QINIU_DOMAIN=请填写访问域名
# 说明: 七牛云空间绑定的域名
```

#### AI服务配置
```bash
# DeepSeek API密钥
DEEPSEEK_API_KEY=请填写DeepSeek API Key
# 说明: DeepSeek AI服务的API密钥
# 获取地址: https://platform.deepseek.com/

# DeepSeek API地址
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions
# 说明: DeepSeek API端点，通常不需要修改

# DeepSeek模型名称
DEEPSEEK_MODEL=deepseek-chat
# 说明: 使用的AI模型名称，可选值参考DeepSeek文档
```

#### 微信小程序配置
```bash
# 微信小程序AppId
WECHAT_APP_ID=请填写微信小程序AppId
# 说明: 微信小程序的唯一标识符
# 获取地址: 微信公众平台 -> 小程序管理

# 微信小程序AppSecret
WECHAT_APP_SECRET=请填写微信小程序AppSecret
# 说明: 微信小程序的密钥
# 注意: 请妥善保管，不要泄露
```

### 可选配置项

#### Redis缓存配置
```bash
# Redis主机地址
REDIS_HOST=localhost
# 说明: Redis服务器地址，未配置则不使用缓存

# Redis端口
REDIS_PORT=6379
# 说明: Redis服务端口，默认6379

# Redis密码
REDIS_PASSWORD=
# 说明: Redis访问密码，留空表示无密码

# Redis数据库索引
REDIS_DATABASE=0
# 说明: 使用的Redis数据库索引，0-15
```

#### 邮件服务配置
```bash
# 邮件服务器地址
MAIL_HOST=
# 说明: SMTP服务器地址，如 smtp.qq.com

# 邮件服务器端口
MAIL_PORT=587
# 说明: SMTP端口，通常为25、465或587

# 邮件用户名
MAIL_USERNAME=
# 说明: 邮箱账户用户名

# 邮件密码
MAIL_PASSWORD=
# 说明: 邮箱密码或授权码

# 发件人地址
MAIL_FROM=
# 说明: 发件人邮箱地址
```

#### 安全配置
```bash
# 最大登录尝试次数
SECURITY_MAX_LOGIN_ATTEMPTS=5
# 说明: 登录失败后锁定账户的尝试次数

# 账户锁定时间（毫秒）
SECURITY_LOGIN_LOCKOUT_DURATION=300000
# 说明: 5分钟=300000毫秒，账户锁定时长
```

#### 文件上传配置
```bash
# 最大文件大小
FILE_UPLOAD_MAX_SIZE=50MB
# 说明: 单个文件最大上传大小限制

# 允许的文件类型
FILE_UPLOAD_ALLOWED_TYPES=mp4,avi,mov,wmv,flv,mkv,pdf,doc,docx,ppt,pptx,xls,xlsx,txt,jpg,jpeg,png,gif
# 说明: 允许上传的文件扩展名，用逗号分隔
```

#### 性能配置
```bash
# 数据库连接池最大连接数
HIKARI_MAX_POOL_SIZE=20
# 说明: 根据并发需求调整，过大会消耗资源

# 数据库连接池最小空闲连接数
HIKARI_MIN_IDLE=5
# 说明: 保持的最小连接数，提高响应速度

# Tomcat最大线程数
TOMCAT_MAX_THREADS=200
# 说明: 处理HTTP请求的最大线程数

# Tomcat最大连接数
TOMCAT_MAX_CONNECTIONS=8192
# 说明: 同时接受的最大连接数
```

#### 监控配置
```bash
# 管理端口
MANAGEMENT_PORT=8081
# 说明: Spring Boot Actuator管理端口

# 日志级别
LOGGING_LEVEL=INFO
# 说明: 日志输出级别，可选值: DEBUG, INFO, WARN, ERROR
```

## 🌐 前端配置 (.env.production)

### API服务配置
```bash
# 后端API地址
NEXT_PUBLIC_API_URL=https://api.您的域名.com
# 说明: 后端API服务的完整URL地址
# 注意: 必须是HTTPS协议，替换为实际域名

# WebSocket地址
NEXT_PUBLIC_WS_URL=wss://api.您的域名.com/ws
# 说明: WebSocket连接地址，用于实时通信
# 注意: 使用WSS协议确保安全
```

### 应用基础配置
```bash
# 应用名称
NEXT_PUBLIC_APP_NAME=Sihui管理系统
# 说明: 显示在浏览器标题和页面中的应用名称

# 应用版本
NEXT_PUBLIC_APP_VERSION=1.0.0
# 说明: 当前应用版本号

# 应用描述
NEXT_PUBLIC_APP_DESCRIPTION=四会智慧学习平台管理系统
# 说明: 应用描述信息
```

### 功能开关
```bash
# 启用聊天功能
NEXT_PUBLIC_ENABLE_CHAT=true
# 说明: 是否启用AI聊天功能，true/false

# 启用视频预览
NEXT_PUBLIC_ENABLE_VIDEO_PREVIEW=true
# 说明: 是否启用视频在线预览功能

# 启用AI分析
NEXT_PUBLIC_ENABLE_AI_ANALYTICS=true
# 说明: 是否启用AI数据分析功能

# 启用实时监控
NEXT_PUBLIC_ENABLE_REAL_TIME_MONITORING=true
# 说明: 是否启用实时系统监控
```

### 文件上传配置
```bash
# 最大文件大小（字节）
NEXT_PUBLIC_MAX_FILE_SIZE=52428800
# 说明: 50MB=52428800字节，前端文件大小限制

# 允许的文件类型
NEXT_PUBLIC_ALLOWED_FILE_TYPES=.jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.mp4,.avi,.mov
# 说明: 前端允许选择的文件类型，用逗号分隔
```

### UI配置
```bash
# 默认主题
NEXT_PUBLIC_THEME=light
# 说明: 默认界面主题，可选值: light, dark

# 主色调
NEXT_PUBLIC_PRIMARY_COLOR=#0070f3
# 说明: 应用主色调的十六进制颜色值
```

### 生产环境配置
```bash
# 环境标识
NODE_ENV=production
# 说明: Node.js环境标识，生产环境固定为production

# 禁用遥测
NEXT_TELEMETRY_DISABLED=1
# 说明: 禁用Next.js遥测数据收集
```

## 🌐 Nginx配置 (sihui.conf)

### 域名配置
```nginx
# 将所有"您的域名.com"替换为实际域名
# 示例: example.com

# 后端API域名
server_name api.example.com;

# 前端管理域名  
server_name admin.example.com;
```

### SSL证书配置
```nginx
# SSL证书文件路径
ssl_certificate /opt/sihui/ssl/example.com.crt;
ssl_certificate_key /opt/sihui/ssl/example.com.key;

# 注意: 证书文件名必须与实际文件名一致
```

### 安全配置
```nginx
# SSL协议版本
ssl_protocols TLSv1.2 TLSv1.3;

# 加密套件
ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;

# 安全响应头
add_header X-Content-Type-Options nosniff;
add_header X-Frame-Options DENY;
add_header X-XSS-Protection "1; mode=block";
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
```

### 性能配置
```nginx
# 文件上传大小限制
client_max_body_size 50M;

# Gzip压缩
gzip on;
gzip_comp_level 6;
gzip_types text/plain text/css application/json application/javascript;

# 静态资源缓存
expires 1y;
add_header Cache-Control "public, immutable";
```

## 🔐 安全配置建议

### 密码强度要求
- **数据库密码**: 16位以上，包含大小写字母、数字、特殊字符
- **JWT密钥**: 64位以上随机字符串
- **邮箱密码**: 使用专用密码或授权码

### 密钥生成工具
```bash
# 生成强密码
openssl rand -base64 32

# 生成JWT密钥
openssl rand -base64 64

# 生成随机字符串
uuidgen
```

### 网络安全
- 使用HTTPS/WSS协议
- 配置防火墙规则
- 定期更新SSL证书
- 启用安全响应头

## 🔧 配置验证

### 后端配置验证
```bash
# 检查配置文件语法
cat /opt/sihui/backend/.env

# 测试数据库连接
mysql -u $DB_USERNAME -p$DB_PASSWORD -h $DB_HOST $DB_NAME -e "SELECT 1;"

# 测试Redis连接（如配置）
redis-cli -h $REDIS_HOST -p $REDIS_PORT ping
```

### 前端配置验证
```bash
# 检查配置文件
cat /opt/sihui/frontend/.env.production

# 测试API连接
curl $NEXT_PUBLIC_API_URL/health
```

### Nginx配置验证
```bash
# 测试配置语法
nginx -t

# 重新加载配置
nginx -s reload

# 测试SSL证书
openssl x509 -in /opt/sihui/ssl/*.crt -text -noout
```

## 🚨 常见配置错误

### 后端配置错误
1. **数据库连接失败**
   - 检查DB_HOST、DB_PORT、DB_USERNAME、DB_PASSWORD
   - 确认数据库服务已启动
   - 验证用户权限

2. **JWT令牌问题**  
   - JWT_SECRET长度不足
   - 特殊字符未正确转义
   - 令牌过期时间配置错误

3. **对象存储配置错误**
   - AccessKey权限不足
   - Bucket不存在或无访问权限
   - 端点地址错误

### 前端配置错误
1. **API连接失败**
   - NEXT_PUBLIC_API_URL地址错误
   - 协议不匹配（HTTP vs HTTPS）
   - 跨域配置问题

2. **功能异常**
   - 环境变量名称错误
   - 布尔值配置格式错误
   - 文件大小限制不匹配

### Nginx配置错误
1. **SSL证书问题**
   - 证书文件路径错误
   - 证书与域名不匹配
   - 证书已过期

2. **代理配置错误**
   - 上游服务地址错误
   - 端口未监听
   - 超时时间配置不当

## 📝 配置检查清单

### 部署前检查
- [ ] 所有必填配置项已填写
- [ ] 密码和密钥符合安全要求
- [ ] 域名配置正确
- [ ] SSL证书有效
- [ ] 第三方服务可用

### 部署后验证
- [ ] 服务正常启动
- [ ] API接口可访问
- [ ] 前端页面正常
- [ ] 数据库连接正常
- [ ] 文件上传功能正常
- [ ] AI服务集成正常

---

**💡 提示**: 配置文件中包含敏感信息，请确保文件权限设置正确，避免信息泄露。建议定期轮换密钥和密码。